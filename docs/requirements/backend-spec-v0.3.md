# 智購後台（LIFF）文字規格 v0.3

## 一、系統目標與角色
- 目標：在 LIFF 內提供消費者客服、營運者商品/預約管理、巡補員現場操作與撿貨能力。
- 角色
  - 一般消費者（Consumer）
  - 營運者（Operator）
  - 巡補員（Replenisher）

## 二、共通規則
- 身分識別：LINE userId 為唯一識別。
- 權限：角色 + 資料範圍由後端決定。
- 巡補寫入限制：僅限現場掃碼簽到與巡補中 Session。
- 生效規則：巡補結束才寫入本機庫存並生效。

## 三、功能模組

### A. 消費者客服（LIFF / 一般消費者）
- 功能
  - 客服問題回報
    - 欄位：問題分類、問題描述
    - 附件：圖片必須、影片可選
    - 送出後建立客服問題單
  - 問題進度查詢
    - 列表顯示：問題單編號 / 建立時間 / 狀態
    - 狀態：已收到 / 處理中 / 已回覆
  - 回覆內容查看
    - 顯示官方回覆文字與時間（不含回覆附件）
- 規則
  - 只允許查詢本人問題單
  - 分類選項由後端定義

### B. 商品主檔管理（LIFF / 營運者）
- 功能
  - 列表：商品編號、名稱、售價、圖片、是否上架
  - 新增：商品編號、名稱、售價、圖片、是否上架
  - 編輯：名稱、售價、圖片、是否上架
  - 刪除：後端硬刪除
- 補充
  - 是否上架（Boolean）用於暫時上/下架控制
  - 圖片儲存位置與大小限制由後端定義

### C. 庫存預約設定（LIFF / 營運者）
- 定義
  - 預約設定 = 貨道 × 商品 × 滿倉量 的模板
  - 不等於即時庫存，不直接寫入機台
- 功能
  - 列表：名稱、建立/更新時間
  - 新增空白
  - 從機台複製
  - 從既有預約複製
  - 重新命名
  - 刪除：後端硬刪除
- 編輯內容
  - 每一貨道：商品選擇 / 清空商品 / 滿倉量設定

### D. 巡補員 App（LIFF / 巡補員）
分為「撿貨」與「巡補」兩大功能。

#### D1. 撿貨（出發前）
- 目的：在出發前先統計缺補商品以便撿貨
- 流程
  - 從機台清單多選機台
  - 系統統計所缺商品清單
  - 產生撿貨清單（依商品名稱分組彙總數量）
- 規則
  - 僅顯示於 LIFF，不需匯出
  - 分組彙總依「商品名稱」進行

#### D2. 巡補（到機台現場）
- 進入條件
  - 掃碼機台畫面簽到碼
  - 完成簽到認證並與機台建立連線
- 流程
  - 巡補開始切換
  - 選擇「預約庫存設定」
  - 手動調整實際庫存
  - 巡補結束 → 寫入本機資料庫
  - 切回銷售模式
- 功能
  - 機器基本資訊顯示（只讀）
  - 套用預約設定（更新暫存狀態）
  - 貨道商品選擇/更換（含清空）
  - 貨道存量設定
  - 滿倉量設定
  - 補滿鍵（設為滿倉量）
- 生效規則
  - 巡補結束才寫入本機庫存並生效
  - 銷售模式禁止寫入

## 四、系統架構描述（需求層）
- 後端資料：商品主檔、庫存預約模板、報表等。
- 機台資料：即時庫存、巡補寫入。
- 資料分層與同步：後端與機台資料獨立保存，透過 MQ/Web Services 做結果同步。

## 五、初始客服分類清單
1. 付款問題
2. 商品問題
3. 機台設備問題
4. 取貨問題
5. 其他

## 六、待確認
- 撿貨統計是否以「商品名稱」為唯一 key，若同名不同 SKU 需定義合併或拆分規則。
- 客服分類是否需要自由輸入欄位或額外類型。
